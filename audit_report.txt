AUDIT REPORT: INTEGRATION TESTS

1. AUTHENTICATION ASSUMPTIONS
--------------------------------------------------
OLD TESTS ASSUME:
- Identification strategies can always be mocked (`FakeIdentifierStrategy`) or work with perfect inputs.
- Authentication context (headers, user sessions) is irrelevant to the guard's core locking logic.
- Users are always identified by simple string keys (e.g., 'user_fail').

WHY THIS IS PROBLEMATIC:
- Real systems face missing headers (e.g., no X-Forwarded-For), malformed IPs, or null subjects.
- Trivial mocks bypass the `DefaultIdentifierStrategy` logic, leaving configuration coupling untested.
- It fails to verify how the system behaves when an identity cannot be resolved (e.g., fallback to IP-only).

FUTURE REQUIREMENTS:
- Use real `IdentifierStrategy` implementations in integration tests.
- Test with varied inputs: valid headers, missing headers, and empty contexts.
- Verify behavior when identity resolution fails or is ambiguous.

2. SUBJECT LIFECYCLE ASSUMPTIONS
--------------------------------------------------
OLD TESTS ASSUME:
- The test suite owns the entire database (`flushAll()` is used in `Phase3G12RealRedisTest`).
- Subject IDs and IPs are simple, predictable strings (e.g., '127.0.0.1', 'user_reset').
- Data persistence is ephemeral and only matters for the duration of a single test method.

WHY THIS IS PROBLEMATIC:
- `flushAll()` is destructive and dangerous in shared CI/CD or development environments.
- Simple IDs do not reflect real-world usage (UUIDs, IPv6, special characters).
- It hides potential key collision issues between different parts of the system or parallel test runs.

FUTURE REQUIREMENTS:
- Use strict namespacing/prefixes for test data instead of global flushing.
- Use complex, randomized identifiers (UUIDs, IPv6) to ensure robust key handling.
- Ensure tests clean up only their specific data keys, leaving others intact.

3. INFRASTRUCTURE AVAILABILITY ASSUMPTIONS
--------------------------------------------------
OLD TESTS ASSUME:
- Redis is always available at `127.0.0.1:6379` (Hardcoded in `RealRedisAdapter`).
- The network connection is perfect, instant, and never times out.
- The environment has the necessary extensions (`redis`, `pdo_mysql`) loaded, or simply skips.

WHY THIS IS PROBLEMATIC:
- CI/CD pipelines often run services in containers (e.g., host `redis` instead of `127.0.0.1`).
- Hardcoded connection strings prevent running tests against external or non-standard configurations.
- Skipping tests silently when extensions are missing can lead to false confidence in test coverage.
- Lack of failure testing (timeouts, connection drops) leaves the system vulnerable to production outages.

FUTURE REQUIREMENTS:
- Make connection parameters (Host, Port, Auth) fully configurable via Environment Variables.
- Fail tests explicitly if required infrastructure is misconfigured, rather than skipping silently.
- Include "Chaos" tests that simulate connection timeouts, authentication failures, and service downtime to verify graceful degradation.
